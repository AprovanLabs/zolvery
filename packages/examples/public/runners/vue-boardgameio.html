<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Kossabos</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <!-- Icons -->
    <script src="https://cdn.jsdelivr.net/npm/heroicons-css@0.1.1/heroicons.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/heroicons-css@0.1.1/heroicons.min.css"
      rel="stylesheet"
    />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Modules -->
    <script async src="https://unpkg.com/es-module-shims"></script>
    <script type="importmap">
      {
        "imports": {
          "vue": "https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js",
          "@vueuse/motion": "https://cdn.jsdelivr.net/npm/@vueuse/motion@2.2.6/+esm",
          "@vueuse/rxjs": "https://cdn.jsdelivr.net/npm/@vueuse/rxjs",
          "@vueuse": "https://cdn.jsdelivr.net/npm/@vueuse/core",
          "rxjs": "https://cdn.jsdelivr.net/npm/rxjs@^7/dist/bundles/rxjs.umd.min.js",
          "primevue/config": "https://cdn.jsdelivr.net/npm/primevue/umd/primevue.min.js",
          "@primevue/themes": "https://cdn.jsdelivr.net/npm/boardgame.io@0.50.2/+esm",
          "boardgame.io/core": "https://cdn.jsdelivr.net/npm/boardgame.io@0.50.2/+esm",
          "boardgame.io/client": "https://cdn.jsdelivr.net/npm/boardgame.io@0.50.2/+esm",
          "boardgame.io/ai": "https://cdn.jsdelivr.net/npm/boardgame.io@0.50.2/+esm",
          "@boardgame.io/p2p": "/src/plugins/boardgameio",
          "tweetnacl": "https://cdn.jsdelivr.net/npm/tweetnacl@1.0.3/nacl-fast.min.js",
          "tweetnacl-util": "https://cdn.jsdelivr.net/npm/tweetnacl-util@0.15.1/nacl-util.min.js",
          "peerjs": "https://cdn.jsdelivr.net/npm/peerjs@1.5.4/dist/peerjs.min.js",
          "@kossabos/core": "/src/core",
          "@kossabos/client": "/src/client",
          "@kossabos/client/util": "/src/client",
          "@kossabos/vue": "/src/vue",
          "@kossabos/vue/plugins/boardgameio": "/src/vue/plugins/boardgameio"
        }
      }
    </script>
    <script>globalThis.__DEV__ = true</script>
  </head>
  <body class="text-black bg-white">
    <main id="app"></main>

    <script type="module">
      import { P2P } from '@boardgame.io/p2p';
      import {
        createChildTransport,
        getQueryParam,
        loadClient,
        loadScript,
      } from '@kossabos/client';
      import { KossabosPlugin } from '@kossabos/vue';
      import { BoardgamePlugin } from '@kossabos/vue/plugins/boardgameio';
      import { Client } from 'boardgame.io/client';

      const isHost = true;
      const user = { userId: 'jacob.samps@gmail.com' };
      const config = { numberOfPlayers: 2, isMultiplayer: false };
      const transport = createChildTransport();
      const kossabosClient = loadClient(user, config, transport);

      const projectId = getQueryParam('projectId');
      loadScript(
        `/src/examples/${projectId}/client/index.js`,
        ({ app, game }) => {
          const { numberOfPlayers } = config;
          const boardgameioClient = Client({
            game,
            numPlayers: config.numberOfPlayers,
            debug: false,
            ...(config.isMultiplayer &&  { multiplayer: P2P({ isHost }) }),
          });

          app.use(KossabosPlugin, { client: kossabosClient });

          boardgameioClient.start();
          app.use(BoardgamePlugin, { client: boardgameioClient });
          app.mount('#app');
        },
      );
    </script>
  </body>
</html>
