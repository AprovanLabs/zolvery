const LETTERS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

const WORDS = [
  'ace',
  'acid',
  'acorn',
  'acre',
  'act',
  'actor',
  'add',
  'adobe',
  'adult',
  'age',
  'agent',
  'agave',
  'aid',
  'aim',
  'air',
  'aisle',
  'alarm',
  'album',
  'ale',
  'alert',
  'algae',
  'alien',
  'alley',
  'alloy',
  'almond',
  'alpha',
  'amber',
  'amp',
  'anchor',
  'angel',
  'angle',
  'angry',
  'ankle',
  'ant',
  'anvil',
  'ape',
  'apex',
  'apple',
  'apron',
  'arch',
  'area',
  'arena',
  'ark',
  'arm',
  'armor',
  'army',
  'arrow',
  'art',
  'ash',
  'asset',
  'atlas',
  'atom',
  'baby',
  'back',
  'bacon',
  'badge',
  'bag',
  'bagel',
  'bail',
  'bait',
  'ball',
  'ban',
  'banana',
  'band',
  'bank',
  'bar',
  'barn',
  'baron',
  'base',
  'basin',
  'bat',
  'bath',
  'bay',
  'beach',
  'bead',
  'beak',
  'beam',
  'bean',
  'bear',
  'beard',
  'beast',
  'bed',
  'bee',
  'beef',
  'beet',
  'bell',
  'belly',
  'belt',
  'bench',
  'bend',
  'berry',
  'bike',
  'bird',
  'bite',
  'blade',
  'blank',
  'blast',
  'blaze',
  'blend',
  'blimp',
  'block',
  'blood',
  'bloom',
  'blow',
  'cab',
  'cabin',
  'cable',
  'cactus',
  'cafe',
  'cage',
  'cake',
  'calf',
  'camel',
  'camp',
  'can',
  'canal',
  'candy',
  'cane',
  'canoe',
  'cape',
  'car',
  'card',
  'cargo',
  'carpet',
  'carrot',
  'cart',
  'case',
  'cash',
  'cast',
  'castle',
  'cat',
  'catch',
  'cave',
  'cedar',
  'celery',
  'cell',
  'cent',
  'chain',
  'chair',
  'chalk',
  'champ',
  'chart',
  'chef',
  'cherry',
  'chess',
  'chest',
  'chick',
  'chief',
  'child',
  'chili',
  'chimp',
  'chin',
  'chip',
  'chunk',
  'cigar',
  'city',
  'dam',
  'dance',
  'dart',
  'dash',
  'data',
  'date',
  'dawn',
  'day',
  'deal',
  'dean',
  'deck',
  'deer',
  'delta',
  'den',
  'denim',
  'depot',
  'desk',
  'dial',
  'diary',
  'dice',
  'dig',
  'dime',
  'diner',
  'dirt',
  'disc',
  'dish',
  'disk',
  'ditch',
  'dive',
  'dock',
  'dog',
  'doll',
  'dome',
  'donor',
  'door',
  'dot',
  'dough',
  'dove',
  'draft',
  'drain',
  'drama',
  'drape',
  'draw',
  'dream',
  'dress',
  'drill',
  'drink',
  'drive',
  'drop',
  'drum',
  'duck',
  'dune',
  'eagle',
  'ear',
  'earth',
  'east',
  'echo',
  'edge',
  'eel',
  'egg',
  'ego',
  'elbow',
  'elder',
  'elm',
  'ember',
  'emoji',
  'empire',
  'end',
  'enemy',
  'energy',
  'engine',
  'entry',
  'envoy',
  'epic',
  'equal',
  'era',
  'error',
  'essay',
  'event',
  'exam',
  'exile',
  'exit',
  'expert',
  'eye',
  'fabric',
  'face',
  'fact',
  'fair',
  'fairy',
  'faith',
  'falcon',
  'fall',
  'fame',
  'family',
  'fan',
  'fang',
  'farm',
  'fate',
  'fault',
  'favor',
  'feast',
  'feather',
  'fee',
  'feed',
  'game',
  'gamma',
  'gap',
  'garage',
  'garden',
  'garlic',
  'gas',
  'gate',
  'gauge',
  'gaze',
  'gear',
  'gecko',
  'gel',
  'gem',
  'gene',
  'genius',
  'ghost',
  'giant',
  'gift',
  'ginger',
  'giraffe',
  'girl',
  'glare',
  'glass',
  'globe',
  'gloom',
  'glory',
  'gloss',
  'glove',
  'glow',
  'glue',
  'goal',
  'goat',
  'gold',
  'golf',
  'goose',
  'gorge',
  'grace',
  'grade',
  'grain',
  'grand',
  'grape',
  'graph',
  'grasp',
  'grass',
  'grave',
  'gray',
  'greed',
  'green',
  'grid',
  'grill',
  'grin',
  'habit',
  'hail',
  'hair',
  'half',
  'hall',
  'halo',
  'ham',
  'hammer',
  'hand',
  'handle',
  'happy',
  'harbor',
  'harm',
  'harp',
  'hat',
  'hatch',
  'haven',
  'hawk',
  'hay',
  'hazard',
  'head',
  'heat',
  'heavy',
  'hedge',
  'heel',
  'height',
  'help',
  'hemp',
  'hen',
  'herb',
  'hero',
  'hill',
  'hint',
  'hip',
  'hippo',
  'hive',
  'hobby',
  'hockey',
  'hold',
  'hole',
  'hollow',
  'home',
  'honey',
  'hood',
  'hook',
  'hope',
  'horn',
  'horse',
  'host',
  'hotel',
  'hour',
  'house',
  'ice',
  'icon',
  'idea',
  'ideal',
  'igloo',
  'image',
  'impact',
  'import',
  'inch',
  'index',
  'infant',
  'ink',
  'inlet',
  'inn',
  'inner',
  'input',
  'insect',
  'iron',
  'island',
  'issue',
  'item',
  'ivory',
  'ivy',
  'jacket',
  'jade',
  'jail',
  'jam',
  'jar',
  'jaw',
  'jazz',
  'jeans',
  'jeep',
  'jelly',
  'jet',
  'jewel',
  'job',
  'joker',
  'joint',
  'joke',
  'jolly',
  'jolt',
  'joy',
  'judge',
  'juice',
  'jump',
  'jungle',
  'junior',
  'junk',
  'jury',
  'kale',
  'karma',
  'kayak',
  'ketchup',
  'kettle',
  'key',
  'kick',
  'kid',
  'kidney',
  'king',
  'kiosk',
  'kiss',
  'kit',
  'kite',
  'kitten',
  'kiwi',
  'knee',
  'knife',
  'knight',
  'knob',
  'knock',
  'knot',
  'koala',
  'lab',
  'label',
  'labor',
  'lace',
  'ladder',
  'lady',
  'lake',
  'lamb',
  'lamp',
  'land',
  'lane',
  'lap',
  'laptop',
  'laser',
  'latch',
  'late',
  'laugh',
  'lava',
  'law',
  'lawn',
  'layer',
  'lead',
  'leaf',
  'league',
  'leap',
  'learn',
  'lease',
  'lemon',
  'lens',
  'level',
  'lever',
  'lid',
  'magic',
  'magnet',
  'maid',
  'mail',
  'main',
  'major',
  'mama',
  'man',
  'mango',
  'manor',
  'map',
  'maple',
  'marble',
  'march',
  'mare',
  'margin',
  'mark',
  'market',
  'marsh',
  'mask',
  'mass',
  'mast',
  'master',
  'mat',
  'match',
  'math',
  'maze',
  'meadow',
  'meal',
  'meat',
  'medal',
  'media',
  'melon',
  'member',
  'memoir',
  'memory',
  'menu',
  'mercy',
  'mesh',
  'mess',
  'metal',
  'method',
  'metro',
  'mice',
  'middle',
  'mile',
  'milk',
  'mill',
  'mind',
  'mine',
  'minor',
  'mint',
  'nail',
  'name',
  'nap',
  'napkin',
  'nation',
  'native',
  'nature',
  'navy',
  'neck',
  'needle',
  'nerve',
  'nest',
  'net',
  'news',
  'newt',
  'night',
  'ninja',
  'noble',
  'node',
  'noise',
  'noodle',
  'noon',
  'north',
  'nose',
  'note',
  'novel',
  'nozzle',
  'number',
  'nurse',
  'nut',
  'oak',
  'oar',
  'oasis',
  'oat',
  'object',
  'ocean',
  'octave',
  'offer',
  'office',
  'oil',
  'olive',
  'onion',
  'open',
  'opera',
  'option',
  'orange',
  'orbit',
  'orca',
  'order',
  'organ',
  'origin',
  'otter',
  'pace',
  'pack',
  'paddle',
  'page',
  'pail',
  'pain',
  'paint',
  'pair',
  'palace',
  'palm',
  'pan',
  'panda',
  'panel',
  'panic',
  'pants',
  'paper',
  'parade',
  'parent',
  'park',
  'parrot',
  'party',
  'pass',
  'pasta',
  'paste',
  'patch',
  'path',
  'patio',
  'patrol',
  'pause',
  'paw',
  'pay',
  'pea',
  'peace',
  'peach',
  'peak',
  'peanut',
  'pear',
  'pearl',
  'pedal',
  'pencil',
  'penny',
  'pepper',
  'perch',
  'period',
  'permit',
  'person',
  'pest',
  'pet',
  'phone',
  'piano',
  'picnic',
  'pie',
  'quail',
  'quake',
  'queen',
  'query',
  'quest',
  'quick',
  'quiet',
  'quill',
  'quilt',
  'quiz',
  'quote',
  'rabbit',
  'race',
  'rack',
  'radar',
  'radio',
  'raft',
  'rage',
  'rail',
  'rain',
  'ramp',
  'ranch',
  'range',
  'rank',
  'rapid',
  'ratio',
  'raven',
  'razor',
  'reach',
  'read',
  'realm',
  'rebel',
  'recipe',
  'record',
  'red',
  'reef',
  'regal',
  'region',
  'relief',
  'remedy',
  'rent',
  'reply',
  'report',
  'rescue',
  'resort',
  'rest',
  'result',
  'return',
  'reward',
  'rhino',
  'rhythm',
  'rib',
  'salad',
  'sale',
  'salmon',
  'salon',
  'salt',
  'sand',
  'sapphire',
  'satin',
  'sauce',
  'scale',
  'scan',
  'scene',
  'scent',
  'school',
  'scope',
  'score',
  'scout',
  'screen',
  'script',
  'sea',
  'seal',
  'search',
  'season',
  'seat',
  'secret',
  'seed',
  'sense',
  'series',
  'serve',
  'set',
  'setup',
  'shade',
  'shadow',
  'shaft',
  'shake',
  'shame',
  'shape',
  'share',
  'shark',
  'shed',
  'sheep',
  'sheet',
  'shelf',
  'shell',
  'shift',
  'shine',
  'ship',
  'shirt',
  'shock',
  'shoe',
  'shop',
  'shore',
  'table',
  'tablet',
  'taco',
  'tail',
  'talent',
  'talk',
  'tank',
  'tap',
  'tape',
  'target',
  'task',
  'taste',
  'taxi',
  'tea',
  'teach',
  'team',
  'tear',
  'tech',
  'teeth',
  'temple',
  'tenant',
  'tent',
  'term',
  'test',
  'text',
  'theme',
  'theory',
  'thief',
  'thing',
  'thorn',
  'thread',
  'throat',
  'throne',
  'thumb',
  'ticket',
  'tide',
  'tiger',
  'tile',
  'timber',
  'time',
  'tip',
  'tire',
  'title',
  'toast',
  'today',
  'toe',
  'tomato',
  'tone',
  'tongue',
  'tool',
  'tooth',
  'top',
  'ugly',
  'ultra',
  'umbrella',
  'uncle',
  'under',
  'unicorn',
  'union',
  'unique',
  'unit',
  'unity',
  'update',
  'upgrade',
  'upper',
  'urban',
  'urge',
  'urn',
  'use',
  'user',
  'usual',
  'utopia',
  'vacuum',
  'valid',
  'valley',
  'value',
  'valve',
  'van',
  'vapor',
  'vault',
  'vector',
  'vegan',
  'velvet',
  'vendor',
  'venue',
  'verb',
  'verse',
  'vessel',
  'vest',
  'video',
  'view',
  'villa',
  'vine',
  'viola',
  'violet',
  'violin',
  'viral',
  'virus',
  'visa',
  'vision',
  'visit',
  'visual',
  'vocal',
  'voice',
  'waffle',
  'wage',
  'wagon',
  'waist',
  'wait',
  'walk',
  'wall',
  'wallet',
  'walnut',
  'walrus',
  'wand',
  'ward',
  'warm',
  'warn',
  'wasp',
  'waste',
  'watch',
  'water',
  'wave',
  'wax',
  'way',
  'wealth',
  'weapon',
  'wear',
  'weasel',
  'weather',
  'web',
  'wedding',
  'wedge',
  'week',
  'weight',
  'weird',
  'welcome',
  'well',
  'west',
  'wet',
  'whale',
  'wheat',
  'wheel',
  'whisper',
  'white',
  'whole',
  'wick',
  'width',
  'wife',
  'wild',
  'will',
  'willow',
  'win',
  'wind',
  'window',
  'wine',
  'xerox',
  'xray',
  'yacht',
  'yam',
  'yard',
  'yarn',
  'year',
  'yeast',
  'yellow',
  'yes',
  'yoga',
  'yolk',
  'young',
  'youth',
  'zebra',
  'zero',
  'zest',
  'zigzag',
  'zinc',
  'zone',
  'zoo',
  'zoom',
  'zucchini',
  'acid',
  'acorn',
  'acre',
];

const WORD_TO_PAIR = new Map<string, string>();
const PAIR_TO_WORD = new Map<string, string>();
const WORD_LIST: string[] = [];

for (let i = 0; i < 676; i += 1) {
  const first = Math.floor(i / 26);
  const second = i % 26;
  const pair = `${LETTERS[first]}${LETTERS[second]}`;
  const word = WORDS[i];
  WORD_TO_PAIR.set(word, pair);
  PAIR_TO_WORD.set(pair, word);
  WORD_LIST.push(word);
}

function pairToWord(pair: string): string | null {
  if (!/^[A-Z]{2}$/.test(pair)) return null;
  return PAIR_TO_WORD.get(pair) || null;
}

function codeToWords(code: string): string[] | null {
  const normalized = code.toUpperCase();
  if (!/^[A-Z]{6}$/.test(normalized)) return null;
  const first = pairToWord(normalized.slice(0, 2));
  const second = pairToWord(normalized.slice(2, 4));
  const third = pairToWord(normalized.slice(4, 6));
  if (!first || !second || !third) return null;
  return [first, second, third];
}

function wordsToCode(words: string[]): string | null {
  if (words.length !== 3) return null;
  const pairs = words.map((word) =>
    WORD_TO_PAIR.get(word.trim().toLowerCase()),
  );
  if (pairs.some((pair) => !pair)) return null;
  return pairs.join('');
}

function isValidWord(word: string): boolean {
  return WORD_TO_PAIR.has(word.trim().toLowerCase());
}

function levenshtein(a: string, b: string): number {
  const m = a.length;
  const n = b.length;
  const dp: number[][] = Array.from({ length: m + 1 }, () =>
    Array(n + 1).fill(0),
  );
  for (let i = 0; i <= m; i++) dp[i][0] = i;
  for (let j = 0; j <= n; j++) dp[0][j] = j;
  for (let i = 1; i <= m; i++) {
    for (let j = 1; j <= n; j++) {
      dp[i][j] =
        a[i - 1] === b[j - 1]
          ? dp[i - 1][j - 1]
          : 1 + Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]);
    }
  }
  return dp[m][n];
}

function fuzzyMatch(input: string, limit = 6): string[] {
  const q = input.trim().toLowerCase();
  if (!q) return [];
  const exact = WORD_LIST.filter((w) => w === q);
  if (exact.length) return exact;
  const prefix = WORD_LIST.filter((w) => w.startsWith(q));
  if (prefix.length <= limit) return prefix;
  const contains = WORD_LIST.filter((w) => w.includes(q));
  if (contains.length <= limit) return contains;
  const scored = WORD_LIST.map((w) => ({ w, d: levenshtein(q, w) }))
    .filter(({ d }) => d <= 3)
    .sort((a, b) => a.d - b.d);
  return scored.slice(0, limit).map(({ w }) => w);
}

export {
  LETTERS,
  WORD_LIST,
  codeToWords,
  wordsToCode,
  pairToWord,
  isValidWord,
  fuzzyMatch,
};
